import {
  Flex,
  VStack,
  Container,
  HStack,
  Image,
  Center,
  Spinner,
} from "@chakra-ui/react"
import dynamic from "next/dynamic"
import { useState, useEffect } from "react"
import { CarbonizedGraph } from "./CarbonizedGraph"
import { Collection } from "./Collection"

const Chart = dynamic<any>(
  () => import("./CarbonizedGraph").then((mod) => mod.CarbonizedGraph),
  {
    ssr: false,
  },
)

export const CarbonCards = () => {
  const [data, setData] = useState({})
  const [loaded, setLoaded] = useState(false)

  useEffect(() => {
    fetch("https://carbonized-testnet.carbonized.workers.dev").then(
      async (res) => {
        setData(await res.json())
        setLoaded(true)
      },
    )
  }, [])

  const formatData = (data) => {
    return Object.keys(data)
      .map((date) => {
        return {
          date: date,
          value: Object.keys(data[date])
            .map((tokenId) => {
              return {
                tokenId: tokenId,
                value: data[date][tokenId],
                src: `https://celostrials.s3.us-west-2.amazonaws.com/${tokenId}.png`,
              }
            })
            .reduce(
              (obj, item) =>
                Object.assign(obj, { [item.tokenId]: { ...item } }),
              {},
            ),
        }
      })
      .reduce(
        (obj, item) => Object.assign(obj, { [item.date]: item.value }),
        {},
      )
  }

  return (
    <Flex width="100%" color="white" align="center" flexDir="column">
      <VStack width="100%">
        <Container maxW="container.lg" id="mint">
          <Center mt="5em">
            <Image
              minW={"15em"}
              src={"/images/carbonize.png"}
              alt={"carbonize"}
              w="40em"
            />
          </Center>

          <HStack w="100%" mb="3em">
            {loaded ? <Chart data={formatData(data)} /> : <Spinner />}
          </HStack>
          <Collection />
        </Container>
      </VStack>
    </Flex>
  )
}

// let data = {
//   "01/22": {},
//   "02/22": {
//     21: 4470000,
//   },
//   "03/22": {
//     21: 5970054,
//     3: 3675135,
//     8: 980036,
//     9: 4900180,
//   },
//   "04/22": {
//     21: 7459742,
//     3: 7399354,
//     6: 9731610,
//     8: 19490059,
//     9: 9865805,
//     19: 1946322,
//   },
//   "05/22": {
//     21: 8989854,
//     3: 14949270,
//     6: 19932360,
//     8: 54763260,
//     9: 14966180,
//     11: 248309,
//     19: 19878248,
//   },
//   "06/22": {
//     21: 24253200,
//     3: 29299875,
//     6: 29533250,
//     8: 69299875,
//     9: 26916562,
//     11: 488331,
//     19: 143932250,
//   },
//   "07/22": {
//     21: 51008911,
//     2: 100000000,
//     3: 30000000,
//     6: 55045618,
//     8: 72408233,
//     9: 44357628,
//     11: 1944940,
//     19: 294493950,
//   },
//   "08/22": {
//     21: 28804331,
//     2: 276000000,
//     3: 41834525,
//     6: 57893524,
//     8: 70133095,
//     9: 47366905,
//     11: 3893524,
//     19: 413611440,
//   },
//   "09/22": {
//     21: 28804331,
//     2: 517750000,
//     3: 54708063,
//     4: 166029650,
//     6: 59953290,
//     8: 68046710,
//     9: 49941613,
//     15: 43250000,
//     17: 19532900,
//     19: 480551990,
//   },
//   "10/22": {
//     21: 28804331,
//     2: 766000000,
//     3: 66954600,
//     4: 170000000,
//     6: 46610848,
//     8: 46003536,
//     9: 47609080,
//     15: 92750000,
//     16: 47818400,
//     17: 48691040,
//     19: 642669824,
//   },
//   "11/22": {
//     21: 28804331,
//     2: 979750000,
//     3: 79664888,
//     4: 170000000,
//     5: 107319100,
//     8: 46003536,
//     9: 45067022,
//     14: 146890156,
//     15: 160250000,
//     16: 118123370,
//     17: 79195730,
//     19: 844638200,
//   },
//   "12/22": {
//     21: 28804331,
//     2: 1170500000,
//     3: 80000000,
//     4: 170000000,
//     5: 205654700,
//     8: 46003536,
//     9: 45067022,
//     7: 117500000,
//     14: 293482050,
//     15: 223675000,
//     16: 196523760,
//     17: 118261880,
//     18: 300000000,
//     19: 1065223075,
//   },
//   "13/22": {
//     21: 28804331,
//     2: 1334000000,
//     3: 80000000,
//     4: 170000000,
//     5: 254859015,
//     8: 46003536,
//     9: 45067022,
//     7: 250000000,
//     11: 135786956,
//     14: 388721163,
//     15: 223675000,
//     16: 444232415,
//     17: 154890345,
//     18: 498750000,
//     19: 1249451725,
//   },
//   "14/22": {
//     21: 28804331,
//     2: 1516750000,
//     3: 80000000,
//     4: 170000000,
//     5: 298950015,
//     8: 46003536,
//     9: 45067022,
//     7: 400000000,
//     11: 163346676,
//     14: 475923363,
//     15: 304500000,
//     16: 660843407,
//     17: 208716685,
//     18: 800000000,
//     19: 1328133360,
//   },
//   "15/22": {
//     21: 28804331,
//     2: 1753500000,
//     3: 80000000,
//     5: 398648000,
//     8: 46003536,
//     9: 45067022,
//     7: 550000000,
//     10: 143250000,
//     11: 238972480,
//     12: 238648000,
//     14: 565796720,
//     15: 314500000,
//     16: 847512320,
//     17: 281026560,
//     18: 1000000000,
//     19: 1399053600,
//   },
//   "16/22": {
//     21: 28804331,
//     2: 2035750000,
//     3: 80000000,
//     5: 495657000,
//     8: 46003536,
//     9: 45067022,
//     7: 750000000,
//     10: 195000000,
//     11: 297394200,
//     13: 239142500,
//     14: 593783960,
//     15: 328250000,
//     16: 921742750,
//     17: 357569030,
//     18: 1333333333,
//     19: 1495657000,
//   },
//   "17/22": {
//     21: 28804331,
//     2: 2255250000,
//     3: 80000000,
//     5: 430000000,
//     8: 46003536,
//     9: 45067022,
//     7: 1000000000,
//     10: 246500000,
//     11: 355000000,
//     13: 500000000,
//     14: 624000000,
//     15: 329500000,
//     16: 1000000000,
//     17: 431000000,
//     18: 1433333333,
//     19: 1900000000,
//   },
// }
